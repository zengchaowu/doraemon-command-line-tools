# 计算机组成原理

# 控制器和运算器的区别

运算器只能进行算数运算和逻辑运算。
运算器不会从主存储器中读取指令，只会去读取数据。

控制器去主存储器读取指令并解析，然后告诉运算器进行哪个运算。
控制器负责指令的执行和其他所有部件的协调工作。

# 存储器
存储体 类似于仓库，每个存储单元（存储的东西叫做存储字，其长度叫做存储字长。（字长64也就包含64个存储元，每个存储元通过电容实现一个bit））有编号。每个字节都有编号，但是存储字才是基本存储单元，一个存储字相当于一盒饼干，我们每次访问主存储只能访问一个字，所以才会有字节对齐来提高效率。（如果某个变量的数据存在两个字里面，这样读取一个变量的时候就会需要读取两个字也就是两次）

所以，字节对其的目的是为了让某个变量不会跨多个字存储，这样会损失一部分空间，但是会提高访问效率。

MAR 地址寄存器，根据CPU指示，一般是需要存或者取的地址（通过地址总线从控制器传过来）。（存储字长限制了存储单元的数量，16位就代表最多有2的16次方个存储单元。）
MDR 数据寄存器，如果CPU要存，这里就是要存的数据。如果CPU要取，这里就放取出来的数据。（位数与存储字长相同，因为需要取数据。）

数据的存取还是依赖CPU，CPU解析指令发出不同的操作（通过控制总线）。

现代CPU中，MAR和MDR在CPU中也存在。

现代计算机按字存数据，但是可以按字，半字，或者字节来取数据。每个字包含多个字节，每个字有一个编号。通过字的编号和偏移量，可以拿到半字和字节（因为字长是已知的）。


# 运算器
ACC：累加器，一般存放操作数或运算结果。（用于加减乘除或者逻辑运算。取余也放在这里，这个有时用来配合MQ存储乘法结果的高位）
MQ：乘商寄存器，与累加器功能相同，但是只用于乘法或者除法。
x：通用寄存器，存放操作数。一般有多个，这些寄存器用于存储加数或者乘数，对应的被加数和被乘数一般存在ACC和MQ中，结果也存在ACC或MQ那里。
ALU：算数逻辑单元，核心部件。实现算数逻辑运算。CU控制ALU进行运算。

# 控制器
CU：控制单元，分析指令，给其他部分发送控制信号。（从IR读取指令然后分析需要进行哪个操作，然后通过控制总线指挥）
IR：指令寄存器，用于存放当前执行的指令
PC：程序计数器，存放下一条指令，会自动加一。

PC-IR-CU 完成指令是这个过程。指令存到指令寄存器后，PC自动加一。
指令的操作码中会指明使用哪个寄存器进行何种操作，是与硬件有关的。

程序最后有一条停机指令，程序停止执行。

# 微指令
计算机的指令有微指令,机器指令和宏指令之分.
控制部件通过控制线向执行部件发出各种控制命令,通常把这种控制命令叫做微命令
微指令是微程序级的命令,它属于硬件
宏指令是由若干条机器指令组成的软件指令,它属于软件;
而机器指令则介于微指令与宏指令之间,通常简称为指令,每一条指令可完成一个独立的算术运算或逻辑运算操作.

我们代码生成的指令就是机器指令，一条机器指令对应一个微程序，一个微程序分成多个微指令执行。每个CPU周期就对应一条微指令。一个机器指令可能使用多个CPU周期。

# 主频
CPU数字脉冲信号频率，和时钟类似，秒针跳一次的时间就是时钟周期。为什么需要时钟周期呢，因为晶体管的变化也是需要时间的，会存在传播时延，例如一个灯同时给两个房间照明，其中一个有一扇门一个有多扇门，门需要手动打开（事实上因为其中一条线路可能有多个逻辑电路），所以在光信号发生变化时，门少的一方会先灭。此时就会有人看到两个房间一个亮一个灭，与我们想表达的信息不同。虽然时间很短，但由于CPU执行速度非常快，所以会出现问题。所以，我们每隔一秒（也就是一个时钟周期），对状态进行同步，给光足够多的时间。

2.9GHz也就是一秒会发出2.9G个时钟信号。
2MIPS 就是一秒执行2M条指令（平均）
2GFLOPS 一秒执行2G次浮点运算（平均），判断CPU运算能力。

时钟周期：一个节拍。一个时钟周期可完成一个或几个须同时执行的操作。时钟周期是由CPU时钟定义的定长时间间隔，是CPU工作的最小时间单位，也称节拍脉冲或T周期。

机器周期/CPU周期：完成一个基本操作所需要的时间叫做机器周期，单个时钟周期根本干不了一件完整的事情（如取指令、写寄存器、读寄存器等），通常用内存中读取一个指令的最短时间来规定CPU周期。现代CPU周期不固定，最早CPU出现过固定为16*时钟周期的CPU周期。

指令周期：一个机器周期能完成一项基本操作，但一条指令常常是需要多项基本操作结合才能完成，完成一条指令所需的时间就是指令周期，当然不同的指令，其指令周期就不一样的了。指令周期与当时的CPU状态有关，所以其时长无法确定。

例子：
一条指令：从内存中读取一个变量a放入到寄存器ACC中

指令完整执行完的时间叫做指令周期，微指令执行周期叫做微指令周期。
指令（机器指令对应一个微程序）分为三步（三个微指令）：取指令，取a地址，放入寄存器。每一步执行完的时间叫做CPU周期（微指令周期）。指令不同，机器周期不同（都是时钟周期的倍数）。
每个微指令包含控制字段，控制字段的每一个bit为一个微命令（的开关），每一个微命令对应一个微操作。（微指令对于CPU来说也很复杂，所以需要分解成多个微操作）。CPU的CU产生一串信号。例如PC+1，译码等。


# 进制转换
3.26
十进制转其他进制，分为小数部分和整数部分，整数部分使用除商取余，小数部分使用乘积取整数部分。
例如0.3无法被二进制准确标识，所以转换为二进制就会存在精度问题。

# 大小端
多字节数据的存放方式。
如果将数据低字节放在高地址，则为大端。
例如 “你”占用两个字节，B0H A1H，如果在内存中BOH存在低地址。则为大端。
小端更容易被机器处理。大端更可读。

# 信息校验
由于信息在传输过程中可能会发生变化，例如电磁干扰之类的。
所以在二进制数据中加入一些判断位，用来校验是否正确。

奇/偶校验码：给首位加上0或者1，将数据1的个数凑位奇数或者偶数（奇校验/偶校验）。
一般用异或实现校验码的生成和校验。

信息纠错：
海明校验码，对数据分组，生成多个偶校验码。这样我们能知道哪个部分校验出错。
但是只能检查出哪一个bit出错，如果出现多个bit错误，就会要求重传。

循环冗校验码余：
双方约定一个除数，在接收到后取余为0则正确。


# 定点数和浮点数：
定点数：
整数部分和小数部分分开存储，每个都有符号位。与整数相同存储

补码：
计算机使用补码进行定点数计算。原码-》符号位1则其他位取反-》再加一为补码-》再加1又变回原码。（正数的反码和补码都相同）
使用补码不会存在真0和假0.所以能多表示一个数。

移码：
补码将符号位取反，则为移码。只能用于整数。很容易用来判断哪个数字更大。


# 原码 反码 补码 移码
因为原码存在符号位，加法器更容易制作，所以使用加法取代减法。（加法取余来替代减法，17点就是5点）
所以使用补码进行操作（补码拥有将减法替换成加法，ALU中恰好不需要减法器）。


# 乘法实现
乘法通过ACC结合MQ，右移再利用ALU进行加法。类似于数学计算中的手算乘法。不是说*1000就是进行1000次加法。
我们小时候用的是一位乘法，现代计算机会进一步优化，出现两位乘法之类的。一位乘法，每次乘最后一位后，对寄存器内容进行右移。


# 浮点数
由于定点数，整数部分和小数部分分开存储，然后按照位权进行计算。