---
title: 作用域
slug: /overview/scope
---

## 运行时变量存储确定

表达式进行计算时会产生临时变量，用来存储表达式的值。临时变量由专门的临时变量生成函数产生。

## 编译程序组织空间
存放目标代码
存放数据结构
存放运行时控制连接数据

静态分配：
编译时就能确定数据空间大小。
不能嵌套，不能递归。不能申请内存，编译器能在编译时就对所有变量分配好地址。

动态分配；
允许手动管理内存，现代语言一般为动态分配。

1.栈式分配。
过程调用一般使用栈式分配来分配存储空间。
2.堆式分配。
由于malloc无法确定位置，


程序内存格局：
代码
静态数据
栈区
|
堆区

活动记录：
每次进入过程或者函数，就会产生一个活动记录放在栈顶。
这个活动记录就包含连接数据，形式参数，局部变量，局部数组的内情向量和临时工作单元。

栈区：
内存栈，在函数进入或者跳出时，栈区会向下增长，分配新的内存给新的活动记录。
过程结束，则将活动记录的内存占用销毁。

非嵌套过程语言：
函数不能嵌套，但是允许递归和可变数组等内存分配。

活动记录内容：
活动记录的大小是可以编译时确定的，因为可以计算出。
自下而上分别是：
老SP：上个活动记录的其实地址
返回地址：当前执行完
参数个数：
形参个数：
局部变量/数组内情向量/临时单元

函数调用过程：
函数调用
call(p1,p2,p3)会翻译成4元式，生成一组中间代码。

获取其他活动记录中的变量的方法：
1.动态链和静态链：
在活动记录中增加动态链和静态链指针。
静态链指向过程所属的上一层level的活动记录的首地址。
动态链指向调用此函数的活动记录的首地址。
2.动态链和display表
在活动记录中添加一个display表存储当前过程，和所有外层的最新的活动记录的起始地址。
display表，会存储每个过程所处的层次。最外层为0。

基本块：进行优化
将代码划分为基本块，也就是只有一个入口语句和一个出口语句的代码序列。
