# 中断

# 诞生
多任务出现后，因为需要时间片轮转。
时钟管理部分发出中断信号，告诉CPU这个时间片完成，需要切换到核心态（交给操作系统内核）对中断进行处理。内核发现是事件片中断信号，就将开始执行下一个任务。

很多关键操作只能在内核态执行，所以应用程序需要通过中断信号告诉CPU进行处理。例如输入输出也需要通过中断信号告诉CPU切换内核态操作。而这中间的接口就是内核态提供给应用程序的。

# 意义
中断信号类似于内核与其他设备进行通信的工具，IO设备通过发送中断信号给CPU，告知其是否完成输入输出。时钟管理发送中断信号告知事件片是否应该切换到下一个程序。

# 作用
1. 中断发生时，CPU立刻进入核心态（而不是切换到内核，是CPU切换为内核态以后，才执行操作系统内核进程）
2. 中断发生后，当前进程暂停，由操作系统内核对中断进行处理。
3. 中断信号有多种类型。
4. 只有中断才能让CPU从用户态切换为核心态，通过操作PSW标识位（这是特权指令），从核心态切换成用户态。

# 中断分类
1. 内中断/异常（trap，缺页，软件异常）
与指令有关，来自CPU内
trap/陷阱：有意为之的，如系统主动调用
fault/故障：错误条件引起的，例如缺页故障，可能被故障处理程序修复
abort/终止：致命错误，例如逻辑错误：整数除0。即使操作系统也无法修复这种错误

2. 外中断（外设：打印机打印完成发送，人工干预：强制关闭应用）
与指令无关，来自CPU外
CPU每执行完一个指令（每隔一个指令周期），就会检查有没有外部中断信号。如果发现有，就暂停运行，此时需要保存当前运行的状态，例如各个寄存器的数据。然后根据中断类型，进入对应的中断处理程序（属于内核）。中断处理完成后就会返回原进程恢复之前的状态，继续执行。